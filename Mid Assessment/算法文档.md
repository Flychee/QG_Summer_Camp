## 算法文档
### 具有差分隐私的基于项目协同过滤算法实现
####  数据预处理
##### 1. 数据分析
在对论文中给出的movielens数据集分析中得出，与算法紧密相关的评分矩阵是一个稀疏矩阵，虽然数据清洗的难度不大，但是稀疏矩阵会对算法的运算产生一定的影响。
##### 2. 数据清洗
观察数据，发现评价集存在一些nan值，等价于用户未进行评分。根据协同过滤算法的相似度概念可知，评价集上的0分不能理解为用户对项目的评分是0分，而应同样理解为用户未进行评分。基于此，将nan替换为0，得到最终数据。
#### 相似度
项目间的相似度衡量了其评分的相似程度（共同评分用户、评分值）
##### 1. 基于余弦的相似度
给定$i,j$项目，其评分向量为$r_i,r_i$，$i，j$间基于余弦的相似度为$$s(i,j)=\frac{r_i・r_j}{||r_i||・||r_j||}$$
##### 2. 皮尔逊相关系数
给定项目$i,j$，其评分向量为$r_i,r_i$，$i，j$的皮尔逊相关系数为$$s(i,j) = \frac{E(r_i・r_j)-E(r_i)E(r_j)}{Var(r_i)Var(r_j)}$$
##### 3. 待选项目集
对于项目$i$，算法会优先遴选与其相似度$s(i,・)$更高的项目形成待选项目集$I$，后续将在此抽取邻居。
#### 基于指数机制的邻居选取
##### 1. 共同评分用户集
对于项目$i,j$，若存在用户$x$有$r_{xi} \neq \empty $且$r_{xj} \neq \empty $，所有这样的用户组成共同评分用户集$U_{ij}$
##### 2. Recommendation-Aware Sensitivity
Recommendation-Aware Sensitivity简称RS，是在局部敏感度的基础上提出的概念。用于计算评分集之间的敏感度。
$$RS(i,j)=max\{max_{u_x \in U_{ij}}(\frac{r_{xi}・r_{xj}}{||r_{i}^{'}||・||r_{j}^{'}||}),max_{u_x \in U_{ij}}\frac{r_{xi}・r_{xj}(||r_{i}||・||r_{j}-||r_{i}||・||r_{j}||)}{||r_{i}^{'}||・||r_{j}^{'}||・||r_{i}||・||r_{j}||}\}$$
##### 3. 平滑RS敏感度
$$B(RS(i,j)) = exp(-\beta)・RS(i,j)$$
为了简洁，文档以下内容与论文一样使用$RS(i,j)$表示$B(RS(i,j))$。
##### 4. 截断相似度
###### 4.1 概念
设$s_k$为第k大相似度，为了简化运算，将所有小于$s_k-\omega$相似度截断为$s_k-\omega$，即
$${\hat{s}}(i,j) = max(s(i,j),s_k(i,・)-\omega)$$
###### 4.2 截断参数$\omega$
定义隐私预算$\epsilon$，概率$\rho$，$RS$为平滑$RS$敏感度最大值，$k$为选取邻居数。
$$\omega =min(s_k,\frac{4k・RS}{\epsilon}ln\frac{k・(|v|-k)}{\rho})$$
##### 5.邻居选取实现
根据截断相似度，将待选项目集中相似度未被截断的项目设为$C1$集，其余设为$C0$集，我们为待选项目集每个元素设置概率为
$$\frac{exp(\frac{\epsilon・{\hat{s}}(i,j))}{4k・RS(i,j)})}{\sum_{j\in C_1}exp(\frac{\epsilon・{\hat{s}}(i,j))}{4k・RS(i,j)})+|C_0|exp(\frac{\epsilon・{\hat{s}}(i,j))}{4k・RS(i,j)})}$$
以不放回抽样完成邻居选取，邻居集记为$N_k(t_i)$。
#### 基于拉普拉斯机制的相似度保护
设项目$j$属于邻居集$N_k(t_i)$，在预测用户$a$对项目$i$之前，我们需要对$s(i,j)$添加拉普拉斯噪声，获得差分隐私保护。记为
$$s_{noise}(i,j)=s(i,j)+Lap(\frac{2・RS(i,j)}{\epsilon})$$
#### 基于项目的协同过滤算法
在算法的最后一步，我们使用已添加噪声的相似度完成对评分${\hat{r}}_{ai}$的预测，即为
$${\hat{r}}_{ai}={\overline{r}}_i+\frac{\sum_{j=1}^k(s_{noise}(i,j)(r_{a,j}-{\overline{r}_k}))}{\sum_{j=1}^ks_{noise}(i,j)}$$